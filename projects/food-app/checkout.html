<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout | FoodieX</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://kit.fontawesome.com/7a4b62b0a4.js"
      crossorigin="anonymous"></script>
  </head>

  <body class="bg-black text-white">
    <!-- ================= NAVBAR ================= -->
    <nav class="bg-zinc-950 border-b border-zinc-800 sticky top-0 z-50">
      <div class="max-w-6xl mx-auto px-4">
        <div class="flex justify-between items-center py-4">
          <a href="index.html" class="text-2xl font-bold text-green-500">
            FoodieX
          </a>

          <!-- Desktop Menu -->
          <div class="hidden md:flex items-center gap-8 text-sm">
            <a href="index.html" class="hover:text-green-400 transition"
              >Home</a
            >
            <a href="restaurants.html" class="hover:text-green-400 transition"
              >Restaurants</a
            >
            <a href="orders.html" class="hover:text-green-400 transition"
              >Orders</a
            >

            <a
              href="cart.html"
              class="relative hover:text-green-400 transition">
              <i class="fas fa-shopping-cart"></i>
              <span
                id="cartBadge"
                class="absolute -top-2 -right-3 bg-green-500 text-black text-xs px-2 rounded-full">
                0
              </span>
            </a>
          </div>

          <!-- Mobile Toggle -->
          <button id="menuToggle" class="md:hidden text-xl">
            <i id="menuIcon" class="fas fa-bars"></i>
          </button>
        </div>

        <!-- Mobile Menu -->
        <div
          id="mobileMenu"
          class="md:hidden overflow-hidden max-h-0 transition-all duration-300 ease-in-out bg-zinc-900 border-t border-zinc-800">
          <div class="px-6 py-4 space-y-4 text-sm">
            <a href="index.html" class="block hover:text-green-400">Home</a>
            <a href="restaurants.html" class="block hover:text-green-400"
              >Restaurants</a
            >
            <a href="orders.html" class="block hover:text-green-400">Orders</a>
            <a href="cart.html" class="block hover:text-green-400">Cart</a>
          </div>
        </div>
      </div>
    </nav>

    <!-- ================= MAIN ================= -->
    <div class="max-w-6xl mx-auto px-4 py-12 grid md:grid-cols-3 gap-10">
      <!-- LEFT -->
      <div class="md:col-span-2 space-y-10">
        <div class="bg-zinc-900 p-6 rounded-xl border border-zinc-800">
          <h2 class="text-xl font-semibold mb-5">Delivery Details</h2>

          <div class="grid md:grid-cols-2 gap-4">
            <input
              id="name"
              type="text"
              placeholder="Full Name"
              class="p-3 bg-black border border-zinc-700 rounded-lg w-full" />

            <input
              id="phone"
              type="tel"
              placeholder="Phone Number"
              class="p-3 bg-black border border-zinc-700 rounded-lg w-full" />

            <input
              id="address"
              type="text"
              placeholder="Address"
              class="p-3 bg-black border border-zinc-700 rounded-lg w-full md:col-span-2" />

            <input
              id="city"
              type="text"
              placeholder="City"
              class="p-3 bg-black border border-zinc-700 rounded-lg w-full" />

            <input
              id="pincode"
              type="text"
              placeholder="Pincode"
              class="p-3 bg-black border border-zinc-700 rounded-lg w-full" />
          </div>
        </div>

        <div class="bg-zinc-900 p-6 rounded-xl border border-zinc-800">
          <h2 class="text-xl font-semibold mb-5">Payment Method</h2>

          <div class="space-y-3">
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="radio" name="payment" value="upi" checked />
              <span>UPI</span>
            </label>

            <label class="flex items-center gap-3 cursor-pointer">
              <input type="radio" name="payment" value="card" />
              <span>Credit / Debit Card</span>
            </label>

            <label class="flex items-center gap-3 cursor-pointer">
              <input type="radio" name="payment" value="cod" />
              <span>Cash on Delivery</span>
            </label>
          </div>

          <div id="cardForm" class="hidden mt-6 space-y-4">
            <input
              id="cardNumber"
              type="text"
              placeholder="Card Number"
              class="p-3 bg-black border border-zinc-700 rounded-lg w-full" />

            <div class="grid grid-cols-2 gap-4">
              <input
                id="expiry"
                type="text"
                placeholder="MM/YY"
                class="p-3 bg-black border border-zinc-700 rounded-lg w-full" />
              <input
                id="cvv"
                type="text"
                placeholder="CVV"
                class="p-3 bg-black border border-zinc-700 rounded-lg w-full" />
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="bg-zinc-900 p-6 rounded-xl border border-zinc-800 h-fit">
        <h2 class="text-xl font-semibold mb-5">Order Summary</h2>

        <div id="orderItems" class="space-y-3 mb-5"></div>

        <div class="border-t border-zinc-700 pt-4 space-y-2 text-sm">
          <div class="flex justify-between">
            <span>Subtotal</span>
            <span id="subtotal"></span>
          </div>

          <div class="flex justify-between">
            <span>GST (5%)</span>
            <span id="gst"></span>
          </div>

          <div class="flex justify-between">
            <span>Delivery</span>
            <span id="delivery"></span>
          </div>

          <div
            class="flex justify-between font-semibold text-lg text-green-400">
            <span>Total</span>
            <span id="total"></span>
          </div>
        </div>

        <button
          id="placeBtn"
          onclick="placeOrder()"
          class="mt-6 w-full bg-green-500 text-black py-3 rounded-lg font-semibold hover:bg-green-400 transition">
          Place Order
        </button>
      </div>
    </div>

    <!-- ================= SCRIPT ================= -->
    <script>
      /* NAVBAR TOGGLE */
      const menuToggle = document.getElementById("menuToggle");
      const mobileMenu = document.getElementById("mobileMenu");
      const menuIcon = document.getElementById("menuIcon");

      let menuOpen = false;

      menuToggle.addEventListener("click", () => {
        menuOpen = !menuOpen;

        if (menuOpen) {
          mobileMenu.style.maxHeight = mobileMenu.scrollHeight + "px";
          menuIcon.classList.remove("fa-bars");
          menuIcon.classList.add("fa-times"); // use fa-times (more stable)
        } else {
          mobileMenu.style.maxHeight = "0px";
          menuIcon.classList.remove("fa-times");
          menuIcon.classList.add("fa-bars");
        }
      });

      /* CART STATE */
      let cart = JSON.parse(localStorage.getItem("cart") || "[]");
      const DELIVERY_CHARGE = 40;
      const GST_RATE = 0.05;

      /* UPDATE CART BADGE */
      function updateCartBadge() {
        let count = 0;
        cart.forEach((item) => (count += item.qty));
        document.getElementById("cartBadge").innerText = count;
      }

      /* PAYMENT TOGGLE */
      document.querySelectorAll("input[name='payment']").forEach((radio) => {
        radio.addEventListener("change", () => {
          document
            .getElementById("cardForm")
            .classList.toggle("hidden", radio.value !== "card");
        });
      });

      /* CALCULATE */
      function calculateTotal() {
        let subtotal = 0;
        cart.forEach((item) => (subtotal += item.price * item.qty));

        const gst = Math.round(subtotal * GST_RATE);
        const delivery = subtotal > 0 ? DELIVERY_CHARGE : 0;
        const total = subtotal + gst + delivery;

        return { subtotal, gst, delivery, total };
      }

      /* RENDER */
      function renderSummary() {
        const container = document.getElementById("orderItems");
        container.innerHTML = "";

        if (!cart.length) {
          container.innerHTML = `<p class="text-gray-400 text-sm">Your cart is empty.</p>`;
        }

        const { subtotal, gst, delivery, total } = calculateTotal();

        cart.forEach((item) => {
          container.innerHTML += `
<div class="flex justify-between text-sm text-gray-300">
<span>${item.name} × ${item.qty}</span>
<span>₹${item.price * item.qty}</span>
</div>
`;
        });

        document.getElementById("subtotal").innerText = "₹" + subtotal;
        document.getElementById("gst").innerText = "₹" + gst;
        document.getElementById("delivery").innerText = "₹" + delivery;
        document.getElementById("total").innerText = "₹" + total;
      }

      /* VALIDATION */
      function validateForm() {
        const phone = document.getElementById("phone").value.trim();
        const pincode = document.getElementById("pincode").value.trim();

        if (!/^[0-9]{10}$/.test(phone)) {
          alert("Enter valid 10 digit phone number.");
          return false;
        }
        if (!/^[0-9]{6}$/.test(pincode)) {
          alert("Enter valid 6 digit pincode.");
          return false;
        }
        return true;
      }

      /* SAVE ORDER */
      function saveOrder(paymentId) {
        const { subtotal, gst, delivery, total } = calculateTotal();

        const newOrder = {
          id: "FX" + Date.now(),
          paymentId,
          items: cart,
          subtotal,
          gst,
          delivery,
          total,
          status: "Preparing",
          date: new Date().toISOString(),
        };

        let orders = JSON.parse(localStorage.getItem("orders")) || [];
        orders.push(newOrder);

        localStorage.setItem("orders", JSON.stringify(orders));
        localStorage.setItem("lastOrder", JSON.stringify(newOrder));
        localStorage.removeItem("cart");

        window.location.href = "order.html";
      }

      /* PLACE ORDER */
      function placeOrder() {
        if (!cart.length) {
          alert("Cart is empty.");
          return;
        }

        if (!validateForm()) return;

        saveOrder("COD_PAYMENT");
      }

      /* INIT */
      renderSummary();
      updateCartBadge();
    </script>
  </body>
</html>
